# Домашнее задание к занятию "6.6. Troubleshooting"

### Задача 1
Перед выполнением задания ознакомьтесь с документацией по администрированию MongoDB.
Пользователь (разработчик) написал в канал поддержки, что у него уже 3 минуты происходит CRUD операция в MongoDB и её нужно прервать.
Вы как инженер поддержки решили произвести данную операцию:
напишите список операций, которые вы будете производить для остановки запроса пользователя
предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB

	Ищем CRUD операции, выполняющейся в данный момент, -  db.currentOp(). После выполнения команды получим ID операции - opid. Для завершения зависшей операции, выполнить команду db.killOp(<opid>).
	Чтобы ограничить время выполнения запросов можно использовать maxTimeMS(). Лимит продолжительности запроса передается в скобках в миллисекундах. Как только продолжительность запроса достигнит установленного временного лимита: MongoDB завершит это задание.
	
### Задача 2
Перед выполнением задания познакомьтесь с документацией по Redis latency troobleshooting.
Вы запустили инстанс Redis для использования совместно с сервисом, который использует механизм TTL. Причем отношение количества записанных key-value значений к количеству истёкших значений есть величина постоянная и увеличивается пропорционально количеству реплик сервиса.
При масштабировании сервиса до N реплик вы увидели, что:
сначала рост отношения записанных значений к истекшим
Redis блокирует операции записи
Как вы думаете, в чем может быть проблема?

	Если количество устаревших ключей равно или становится больше 25% от общего количества, может заблокировать запись в базу до понижения количества устаревших ключей ниже 25% от всего объема.

### Задача 3
Вы подняли базу данных MySQL для использования в гис-системе. При росте количества записей, в таблицах базы, пользователи начали жаловаться на ошибки вида:
InterfaceError: (InterfaceError) 2013: Lost connection to MySQL server during query u'SELECT..... '
Как вы думаете, почему это начало происходить и как локализовать проблему?
Какие пути решения данной проблемы вы можете предложить?

	Оптимизировать выполнение запроса: добавить индексы, собрать статитику или
	увеличить значения параметров: 
	net_read_timeout
	max_connections
	connect_timeout
	interactive_timeout
	wait_timeout

### Задача 4
Вы решили перевести гис-систему из задачи 3 на PostgreSQL, так как прочитали в документации, что эта СУБД работает с большим объемом данных лучше, чем MySQL.
После запуска пользователи начали жаловаться, что СУБД время от времени становится недоступной. В dmesg вы видите, что:
postmaster invoked oom-killer
Как вы думаете, что происходит?
Как бы вы решили данную проблему?

	Из-за нехватки физической оперативной памяти и swap ОС запустила Out-of-Memory Killer. Причиной может быть то, что какой то процесс больше памяти чем доступно на данный момент. 
	Можно попробовать увеличить физическую память или добавить swap или попробовать подобрать более подходящие значения для параметров work_mem, hash_mem_multiplier, shared_buffers.
	

